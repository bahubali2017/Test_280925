âœ… AGENT PROMPT: Generate Full Documentation for Code Protection Layer (SSR-Based MVP)
# ğŸ“˜ ANAMNESIS MVP â€” CODE PROTECTION PLAN (SSR DEPLOYMENT)

**Target:** `https://mvp.anamnesis.health`  
**Deployment Type:** Web App (Server-Side Rendering)  
**Protection Goal:** Prevent reverse engineering, copying, scraping, or AI misuse of any part of the MVP system.

---

## ğŸ” CODE PROTECTION OVERVIEW

This document outlines the proposed tasks and architecture for implementing a **Code Protection Layer** on the Anamnesis MVP platform before production deployment.

The selected model is:
> **ğŸ”’ Web App (SSR) â€” All business logic and AI orchestration run server-side.**

---

## ğŸ§± PROTECTION PHASE STRUCTURE

### âœ… PHASE 1 â€” PLANNING & DOCUMENTATION (âœ… CURRENT STEP)

- [x] Decide deployment strategy: âœ… SSR selected
- [x] Create this protection plan documentation
- [ ] Review and approve checklist before making changes
- [ ] Archive as `MVP_CODE_PROTECTION_PLAN.md` under `/docs/`

---

### ğŸ” PHASE 2 â€” FRONTEND PROTECTION TASKS (SSR-HARDENED CLIENT)

| Task | Description | Status |
|------|-------------|--------|
| Obfuscate JS output | Use `vite-plugin-obfuscator` for JS code hardening | â˜ Planned |
| Build fingerprinting | Inject per-deploy build ID for tracing copies | â˜ Planned |
| Disable devtools | Prevent inspection (aggressive: disable right-click, F12) | â˜ Optional |
| Hide network logic | Move all chat/A.I. orchestration behind secured API calls | âœ… Already done |

---

### ğŸ›¡ï¸ PHASE 3 â€” BACKEND API PROTECTION (SERVER-SIDE LOGIC)

| Task | Description | Status |
|------|-------------|--------|
| Enforce CORS | Lock access to `https://mvp.anamnesis.health` only | â˜ Planned |
| Rate-limiting | Use `express-rate-limit` on `/api/ask`, `/api/chat` | â˜ Planned |
| Device fingerprint checks | Tie sessions to unique client fingerprint | â˜ Optional |
| IP binding (Enterprise only) | Optional IP pinning for high-risk endpoints | â˜ Optional |
| Token auth | âœ… Already implemented via Bearer token | âœ… Complete |

---

### ğŸ§¬ PHASE 4 â€” AI OUTPUT WATERMARKING & MISUSE PREVENTION

| Task | Description | Status |
|------|-------------|--------|
| Zero-width character injection | Embed invisible tokens in AI responses | â˜ Planned |
| Stylometry watermark | Adjust text patterns to trace output reuse | â˜ Optional |
| Log & hash outputs | Track generated answers for legal proof | â˜ Planned |

---

### ğŸ“¦ PHASE 5 â€” DEPLOYMENT-LAYER SHIELDING

| Task | Description | Status |
|------|-------------|--------|
| Enable HSTS | Add `Strict-Transport-Security` headers | â˜ Planned |
| SSL Certs | Ensure HTTPS only, no fallback to HTTP | â˜ Pending |
| Disable directory listing | Prevent access to `/public/`, `/dist/` | â˜ Planned |
| CSP Headers | Block script injection / eval() on frontend | â˜ Optional |

---

### ğŸ”¥ PHASE 6 â€” TAMPER DETECTION & HONEYPOTS

| Task | Description | Status |
|------|-------------|--------|
| Honeypot endpoints | Fake `/api/model-config`, `/admin/test`, etc. | â˜ Planned |
| Auto-ban bot IPs | Add middleware to block suspicious access | â˜ Planned |
| Self-monitoring loop | Watch for tampering or cloned frontend access | â˜ Optional |

---

### ğŸ“„ PHASE 7 â€” LEGAL & LICENSE FILES

| Task | Description | Status |
|------|-------------|--------|
| LICENSE.txt | Strict EULA for public users | â˜ Drafting |
| TERMS.md | Link from footer + /legal route | â˜ Planned |
| Output reuse clause | Ban use of content for training LLMs | â˜ Planned |

---

## ğŸ“ FILES TO BE CREATED OR MODIFIED

- `/vite.config.ts` â†’ Add obfuscation plugin
- `/src/constants/build.ts` â†’ Inject fingerprint ID
- `/server/middleware/rateLimiter.ts` â†’ New file for rate limit config
- `/server/routes/ask.ts` â†’ Add watermarking
- `/public/LICENSE.txt` â†’ Legal restriction notice
- `/public/TERMS.md` â†’ Frontend terms of use

---

## ğŸ“Œ NEXT ACTIONS

- [ ] Review and confirm plan with project owner (Dr. Wisam Naddaf)
- [ ] Mark this plan as approved
- [ ] Create `/docs/MVP_CODE_PROTECTION_PLAN.md`
- [ ] Move to PHASE 2 implementation task-by-task

---

âœ… *End of Plan Draft. No changes have been made to the codebase yet.*
