REPLIT AGENT PROMPT â€” Phase 5: Data Collection & Analytics Framework

Begin implementation of Phase 5 of the Anamnesis AI system:
"Data Collection & Analytics Framework"

All files should use clean JavaScript with JSDoc annotations, strict ESLint compliance, and structured JSON-compatible data outputs.

ğŸ“ DIRECTORY STRUCTURE TO CREATE:
client/
â””â”€â”€ src/
    â”œâ”€â”€ analytics/
    â”‚   â”œâ”€â”€ data-logger.js             // main logging utility
    â”‚   â”œâ”€â”€ enums.js                   // enums like LLMResponseCategory
    â”‚   â”œâ”€â”€ query-sampler.js           // data sampling engine
    â”‚   â”œâ”€â”€ anonymizer.js              // anonymization utility
    â”‚   â”œâ”€â”€ metadata-logger.js         // logs enriched metadata
    â”‚   â””â”€â”€ analytics-utils.js         // pattern analysis helpers
    â””â”€â”€ training-dataset/
        â”œâ”€â”€ layer-decisions.jsonl      // primary dataset (JSON Lines format)
        â””â”€â”€ logs/                      // rotating raw logs

ğŸ“‹ IMPLEMENTATION TASKS:
ğŸ§© 1. data-logger.js (core logger)

Logs each processed query to training-dataset/layer-decisions.jsonl

Includes:

{
  timestamp,
  userInput,
  finalPrompt,
  llmResponse,
  triageLevel,
  isHighRisk,
  responseCategory, // enum
  metadata: { processingTime, confidence, bodySystem }
}


Uses fs.appendFileSync() (or Replit-compatible storage API)

ğŸ§© 2. enums.js
/**
 * @readonly
 * @enum {"educational" | "generic" | "flagged" | "fallback"}
 */
export const LLMResponseCategory = {
  EDUCATIONAL: "educational",
  GENERIC: "generic",
  FLAGGED: "flagged",
  FALLBACK: "fallback"
}

ğŸ§© 3. query-sampler.js

Buffers queries and only writes to dataset at specified sampling intervals

Randomized probability with adjustable threshold

Supports forceLog = true for high-risk queries

ğŸ§© 4. metadata-logger.js

Adds detailed timing + quality metrics to logs:

parseTime, triageTime, promptTime, totalTime

Flags missing key fields

Writes enriched log objects to rotating .log files in training-dataset/logs/

ğŸ§© 5. anonymizer.js

Strips names, emails, phone numbers, and known entities

Simple RegExp-based first implementation (refinable later)

Use during data-logger write

ğŸ§© 6. analytics-utils.js

Functions:

detectOutliers(): flag unusual query structures

tagQueryCategory(): infer category based on keywords

flagMissingSymptoms(): alert if no symptoms detected

ğŸ§ª 7. analytics.test.js

Verify:

Logger writes valid JSONL

Sampler selects properly

Metadata enriches logs

Anonymizer strips PII

ğŸ›¡ï¸ SECURITY & PRIVACY:

âŒ Never store full chat history or personal details

âœ… All samples must be anonymized before being written

âœ… Redact all free-text fields before use in analytics

âœ… Include privacy disclaimer in code headers

âœ… OBJECTIVE:

Implement all modules above and verify that:

npm run dev still works

npx tsc --noEmit returns 0 errors

npx eslint client/ --ext .js,.jsx returns 0 errors/warnings

training-dataset/layer-decisions.jsonl is properly created with anonymized, structured samples